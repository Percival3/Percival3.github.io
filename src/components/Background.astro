---
// src/components/Background.astro
import BackgroundEffect from './BackgroundEffect';

const bgImage = "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80";
---

<!-- 1. 全局底色层 -->
<div class="fixed inset-0 -z-50 h-full w-full bg-white dark:bg-slate-950 transition-colors duration-500"></div>

<!-- 2. 风景图片层 -->
<div class="absolute top-0 left-0 w-full h-[80vh] -z-40 pointer-events-none overflow-hidden select-none">
  <!-- 
    修正点：
    1. dark:opacity-40 -> dark:opacity-20 (黑夜模式更透明)
    2. 增加了 dark:brightness-50 (黑夜模式图片本身变暗)
    3. transition-all (让切换过程平滑)
  -->
  <img 
    src={bgImage} 
    alt="Hero Background" 
    class="w-full h-full object-cover opacity-90 dark:opacity-20 dark:brightness-50 blur-[1px] transition-all duration-700 ease-in-out"
  />
  
  <!-- 
    新增：强制暗色遮罩 (仅在黑夜模式生效)
    这能保证即使图片很亮，在手机上也会被压暗，确保文字对比度
  -->
  <div class="absolute inset-0 bg-transparent dark:bg-slate-950/30 transition-colors duration-700"></div>

  <!-- 底部渐变融合 (Masking Helper) -->
  <div class="absolute inset-0 bg-gradient-to-b from-transparent via-white/20 to-white dark:via-slate-950/20 dark:to-slate-950 transition-colors duration-700"></div>
</div>

<!-- 3. 纹理与光晕层 -->
<div class="fixed inset-0 -z-30 pointer-events-none">
  <div class="absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px] opacity-40 dark:opacity-10"></div>
  <div class="absolute left-0 right-0 top-0 m-auto h-[500px] w-[500px] rounded-full bg-blue-400/20 dark:bg-blue-900/20 opacity-30 blur-[120px] mix-blend-overlay"></div>
</div>

<!-- 4. 动态特效层 -->
<div class="fixed inset-0 -z-20 pointer-events-none">
  <BackgroundEffect client:only="react" />
</div>

<style>
  img {
    -webkit-mask-image: linear-gradient(to bottom, black 0%, black 60%, transparent 100%);
    mask-image: linear-gradient(to bottom, black 0%, black 60%, transparent 100%);
  }
</style>