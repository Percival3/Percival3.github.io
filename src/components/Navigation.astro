---
// src/components/Navigation.astro
import ThemeToggle from './ThemeToggle';
import LanguageSelector from './LanguageSelector';
// 引入新创建的移动端菜单
import MobileMenu from './MobileMenu'; 
import { getRelativeLocaleUrl } from 'astro:i18n';

interface Props {
  lang: string;
}

const { lang } = Astro.props;

// 1. 定义导航数据
const navItems = {
  zh: [
    { name: '首页', href: '' },
    { name: '博客', href: 'posts' },
    { name: '论文', href: '#' },
    { name: '归档', href: '#' },
    { name: '关于', href: '#' },
  ],
  en: [
    { name: 'Home', href: '' },
    { name: 'Blog', href: 'posts' },
    { name: 'Papers', href: '#' },
    { name: 'Archive', href: '#' },
    { name: 'About', href: '#' },
  ],
  ja: [
    { name: 'ホーム', href: '' },
    { name: 'ブログ', href: 'posts' },
    { name: '論文', href: '#' },
    { name: 'アーカイブ', href: '#' },
    { name: '私について', href: '#' },
  ]
};

const rawItems = navItems[lang as keyof typeof navItems];

// 2. 预处理数据：为 React 组件生成完整的 URL
// 因为 React 组件是在客户端运行的，最好直接传处理好的字符串
const menuItems = rawItems.map(item => ({
  name: item.name,
  url: item.href === '' ? getRelativeLocaleUrl(lang, '') : getRelativeLocaleUrl(lang, item.href)
}));

const languages = [
  { code: 'zh', label: '中文', url: getRelativeLocaleUrl('zh', '') },
  { code: 'en', label: 'English', url: getRelativeLocaleUrl('en', '') },
  { code: 'ja', label: '日本語', url: getRelativeLocaleUrl('ja', '') },
];
---

<header class="sticky top-0 z-50 w-full bg-white/30 dark:bg-slate-950/30 backdrop-blur-md transition-all duration-300">
  <div class="container mx-auto px-4 h-16 flex items-center justify-between">
    
    <!-- Logo -->
    <a href={getRelativeLocaleUrl(lang, '')} class="font-bold text-xl tracking-tight flex items-center gap-2 hover:opacity-80 transition-opacity z-50">
      <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-sm shadow-lg shadow-blue-500/30">
        A
      </div>
      <span class="hidden sm:inline drop-shadow-sm">Astro<span class="text-blue-600 dark:text-blue-400">V5</span></span>
    </a>

    <!-- 
      桌面端导航 
      hidden md:flex: 在手机上隐藏(hidden)，中等屏幕以上显示 flex 布局
    -->
    <nav class="hidden md:flex items-center gap-6 text-sm font-medium text-gray-700 dark:text-gray-200 absolute left-1/2 transform -translate-x-1/2">
      {menuItems.map(item => (
        <a 
          href={item.url} 
          class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors relative group"
        >
          {item.name}
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-blue-600 transition-all group-hover:w-full"></span>
        </a>
      ))}
    </nav>
    
    <!-- 右侧功能区 -->
    <div class="flex items-center gap-2 sm:gap-4 z-50">
      <!-- 语言切换 -->
      <LanguageSelector client:load currentLang={lang} languages={languages} />
      
      <div class="w-px h-4 bg-gray-400/30 hidden sm:block"></div>
      
      <!-- 主题切换 -->
      <ThemeToggle client:load />

      <!-- 
        移动端菜单按钮
        md:hidden: 在中等屏幕及以上隐藏，只在手机显示
        client:load: 必须加，因为需要交互
      -->
      <MobileMenu client:load items={menuItems} />
    </div>
  </div>
</header>